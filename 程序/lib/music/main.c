#include <REG51.H>
#define uchar unsigned char
sbit beepIO=P3^7;
uchar m,n; 
uchar code T[49][2]={{0,0},
{0xF8,0x8B},{0xF8,0xF2},{0xF9,0x5B},{0xF9,0xB7},{0xFA,0x14},{0xFA,0x66},{0xFA,0xB9},{0xFB,0x03},{0xFB,0x4A},{0xFB,0x8F},{0xFB,0xCF},{0xFC,0x0B},
{0xFC,0x43},{0xFC,0x78},{0xFC,0xAB},{0xFC,0xDB},{0xFD,0x08},{0xFD,0x33},{0xFD,0x5B},{0xFD,0x81},{0xFD,0xA5},{0xFD,0xC7},{0xFD,0xE7},{0xFE,0x05},
{0xFE,0x21},{0xFE,0x3C},{0xFE,0x55},{0xFE,0x6D},{0xFE,0x84},{0xFE,0x99},{0xFE,0xAD},{0xFE,0xC0},{0xFE,0x02},{0xFE,0xE3},{0xFE,0xF3},{0xFF,0x02},
{0xFF,0x10},{0xFF,0x1D},{0xFF,0x2A},{0xFF,0x36},{0xFF,0x42},{0xFF,0x4C},{0xFF,0x56},{0xFF,0x60},{0xFF,0x69},{0xFF,0x71},{0xFF,0x79},{0xFF,0x81}
};
uchar code music[][2]={{0,4},
{17,8},{17,8},{17,8},{13,8},{17,4},{18,8},{17,12},{18,4},{17,4},{15,4},{15,12},{22,8},{15,4},{15,12},{0,8},{0,8},{0,8},{20,8},{20,8},{20,8},{15,8},{20,4},{22,4},{20,4},{20,8},{20,4},{22,4},{20,4},{18,4},{18,8},{18,4},{20,4},{18,8},{17,12},{0,8},{0,8},{0,8},{17,8},{17,8},{17,8},{13,8},{17,4},{18,8},{17,8},{17,4},{18,4},{17,4},{15,4},{15,8},{15,4},{22,8},{15,4},{15,12},{0,8},{0,8},{0,8},{20,8},{20,8},{20,8},{15,8},{20,4},{22,4},{20,4},{20,8},{20,4},{22,4},{24,4},{25,4},{25,12},{24,4},{24,8},{25,20},{0,4},
{0xFF,0xFF}};

void delay(uchar p)
{
	uchar i,j; 
	for(;p>0;p--)
	for(i=181;i>0;i--)
	for(j=181;j>0;j--);
}

void pause()
{
	uchar i,j;
	for(i=150;i>0;i--)
	for(j=150;j>0;j--);
}

void T1_int() interrupt 3
{
	beepIO=!beepIO;
	TH1=T[m][0]; TL1=T[m][1];
}

void playmusic()
{
	uchar i=0; 
	TMOD&=0x0F;  TMOD|=0x10;  EA=1; ET1=1; 
	m=music[i][0];n=music[i][1]/2; 
	if(m==0x00)
	{
		TR1=0;
		delay(n);
		i++;
	} 
	else if(m==0xFF)
	{
		TR1=0;
		delay(30);
		return;
	} 
	else if(m==music[i+1][0]) 
	{
		TR1=1;
		delay(n);
		TR1=0;
		pause();
		i++;
	}
	else
	{
		TR1=1;
		delay(n);
		i++;
	}
}

void main()
{
	playmusic();
	while(1);
}